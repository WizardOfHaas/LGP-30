<html>
    <head>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.14.5/xterm.min.css" integrity="sha512-iLYuqv+v/P4u9erpk+KM83Ioe/l7SEmr7wB6g+Kg1qmEit8EShDKnKtLHlv2QXUp7GGJhmqDI+1PhJYLTsfb8w==" crossorigin="anonymous" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.14.5/xterm.min.js" integrity="sha512-2PRgAav8Os8vLcOAh1gSaDoNLe1fAyq8/G3QSdyjFFD+OqNjLeHE/8q4+S4MEZgPsuo+itHopj+hJvqS8XUQ8A==" crossorigin="anonymous"></script>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

        <script src="./lgp30.js"></script>
        <script src="./flexo.js"></script>

        <style>
            table {
                font-family: monospace;
            }

            .ip {
                background-color: red;
            }

            .green {
                background-color: green;
            }

            .red {
                background-color: red;
            }

            textarea{
                width: 100%;
                height: 100%;
            }

            .btn-on{
                background-color: red;
            }

            .btn{
                border: 1px solid black;
                border-radius: 0px;
            }

            .toggle{
                height: 100%;
                width: 100%;
            }

            div:has(>button){
                padding: 0px;
                margin: 0px;
            }

            #run-btns button, #op-btns button{
                font-size: 12;
                height: 60px;
            }

            #op-btns button, #mode-btns button{
                width: 100px;
            }

            #run-btns button{
                margin-bottom: 15px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="row">
                <div class="col-md-7">
                    <table id="run-btns">
                        <tr>
                            <th colspan="3">
                                <button class="btn btn-block" id="stop">STOP</button>
                            </td>
                            <th colspan="3">
                                <button class="btn btn-block" id="compute">COMPUTE</button>
                            </td>
                        </tr>

                        <tr id="mode-btns">
                            <td>
                                <button class="btn btn-block toggle btn-on" id="normal">NORMAL</button>
                            </td>
                            <td>
                                <button class="btn btn-block toggle" id="one-op">ONE<br/>OP</button>
                            </td>
                            <td>
                                <button class="btn btn-block toggle" id="manual">MANUAL<br/>INPUT</button>
                            </td>

                            <td>
                                <button class="btn btn-block toggle" id="stand-by">STAND<br/>BY</button>
                            </td>
                            <td>
                                <button class="btn btn-block toggle" id="opereate">OPERATE</button>
                            </td>
                            <td>
                                <button class="btn btn-block toggle" id="stand-by-to-operate">STAND BY<br/>TO OP</button>
                            </td>
                        </tr>
                    </table>
                </div>

                <div class="col-md-5">
                    <table>
                        <tr>
                            <td>C</td><td id="c"></td><td id="c-dec"></td>
                        </tr>
                        <tr>
                            <td>R</td><td id="r"></td><td id="r-dec"></td>
                        </tr>
                        <tr>
                            <td>A</td><td id="a"></td><td id="a-dec"></td><td id="a-ins"></td>
                        </tr>
                        <tr>
                            <td> </td><td>--------------|O--|T----|S----|</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <table id="op-btns">
                        <tr>
                            <td>
                                <button class="btn btn-block" id="start">START</button>
                            </td>

                            <td>
                                <button class="btn btn-block" id="clear-counter">CLEAR<br/>COUNTER</button>
                            </td>

                            <td>
                                <button class="btn btn-block" id="fill-ins">FILL<br/>INSTRUCTION</button>
                            </td>

                            <td>
                                <button class="btn btn-block" id="ex-ins">EXECUTE<br/>INSTRUCTION</button>
                            </td>

                            <td>
                                <button class="btn btn-block" id="power-on">POWER<br/>ON</button>
                            </td>

                            <td>
                                <button class="btn btn-block" id="power-off">POWER<br/>OFF</button>
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <button class="btn btn-block" id="break-32">BREAK<br/>POINT<br/>32</button>
                            </td>

                            <td>
                                <button class="btn btn-block" id="break-16">BREAK<br/>POINT<br/>16</button>
                            </td>

                            <td>
                                <button class="btn btn-block" id="break-8">BREAK<br/>POINT<br/>8</button>
                            </td>

                            <td>
                                <button class="btn btn-block" id="break-4">BREAK<br/>POINT<br/>4</button>
                            </td>

                            <td>
                                <button class="btn btn-block" id="input-6b">6 BIT<br/>INPUT</button>
                            </td>

                            <td>
                                <button class="btn btn-block" id="xfer-ctrl">TRANSFER<br/>CONTROL</button>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <textarea id="asm">
0000 u 1000 #Jump to entry
1000 p 0000
1001 b 1000
1002 a 2005 #Add up 1 to track
1003 y 1000 #Modify p

1004 b 2002 #Sets A to (2002)
1005 a 2001 #Adds (2001) to A
1006 h 2002 #Saves results in (2002)
1007 s 2003 #Subtracts 5 from A
1008 t 1000 #Tests, and jumps to top of loop
1009 z 0000 #Stop

2001 1 #Counter start
2003 63 #Counter stop
2004 a 2010 #Example fails... so my packing is wrong?
2005 128 #Track = 1. This is our incrementer
                    </textarea>
                </div>

                <div class="col-md-6">
                    <div id="term"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <table id="mem"></table>
                </div>
            </div>
        </div>

        <script>
            //Setup terminal
            //var term = new Terminal({cols: 40});
            //term.open(document.getElementById("term"));

            const flexo = new Flexo({
                target: "term"
            })

            const lgp30 = new LGP30({
                memTarget: "#mem",
                initialAsm: "#asm",
                print: (c) => {flexo.print(c)},
                onStep: () => {
                    if(lgp30.running == true){
                        $("#compute").addClass("green")
                        $("#stop").removeClass("red")
                    }else{
                        $("#compute").removeClass("green")
                        $("#stop").addClass("red") 
                    }
                }
            })

            /*$("#step").on("click", () => {
                lgp30.step()
            })

            $("#run").on("click", () => {
                lgp30.run()
            })*/

            $("#stop").on("click", () => {
                lgp30.stop()
            })

            $("#normal").on("click", () => {
                lgp30.mode = "NORMAL"
            })

            $("#one-op").on("click", () => {
                lgp30.mode = "STEP"
            })

            $("#one-op, #manual, #normal").on("click", (e) => {
                $("#one-op, #manual, #normal").removeClass("btn-on")
                $(e.target).addClass("btn-on")
            })

            $("#start").on("click", () => {
                lgp30.run()
            })
        </script>
    </body>
</html>